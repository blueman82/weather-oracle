"use strict";(()=>{var e={};e.id=90,e.ids=[90],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},7561:e=>{e.exports=require("node:fs")},3977:e=>{e.exports=require("node:fs/promises")},612:e=>{e.exports=require("node:os")},9411:e=>{e.exports=require("node:path")},8577:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>R,requestAsyncStorage:()=>g,routeModule:()=>b,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{GET:()=>f,OPTIONS:()=>h});var o=r(1841),i=r(5328),s=r(2153),n=r(180),l=r(1583),d=r(6347),u=r(7242),c=r(6250),p=r(7539);let m=(0,l._j)({enabled:!0});async function f(e){let t;let r=Date.now(),a=e.nextUrl.searchParams,o=a.get("location"),i=a.get("lat"),s=a.get("lon"),l=a.get("days"),f=a.get("models"),h=o&&o.trim().length>0,b=i&&s;if(!h&&!b)return(0,p.o3)(p.R0.badRequest("Must provide either 'location' parameter or both 'lat' and 'lon' parameters"));let g=5;if(l){let e=parseInt(l,10);if(isNaN(e)||e<1||e>7)return(0,p.o3)(p.R0.badRequest("Days must be a number between 1 and 7",{provided:l}));g=e}if(f){let e=f.split(",").map(e=>e.trim().toLowerCase()),r=Object.keys(n.a4),a=e.filter(e=>!r.includes(e));if(a.length>0)return(0,p.o3)(p.R0.badRequest(`Invalid model names: ${a.join(", ")}`,{validModels:r,invalidModels:a}));t=e}try{var v,y,w;let e;if(b){let t=parseFloat(i),r=parseFloat(s);if(isNaN(t)||t<-90||t>90)return(0,p.o3)(p.R0.badRequest("Latitude must be a number between -90 and 90",{provided:i}));if(isNaN(r)||r<-180||r>180)return(0,p.o3)(p.R0.badRequest("Longitude must be a number between -180 and 180",{provided:s}));e={name:`${t.toFixed(4)}, ${r.toFixed(4)}`,coordinates:(0,n.DC)(t,r),country:"Unknown",countryCode:"XX",timezone:"UTC"}}else e=await (0,d.lF)(o.trim());let a=(v=e.coordinates.latitude,y=e.coordinates.longitude,w=g,`compare_${Math.round(100*v)/100}_${Math.round(100*y)/100}_${w}`),l=await m.get(a);if(l&&!t){let e=Date.now()-r;return(0,p.o3)((0,p.Xj)(l,{duration:e,cached:!0,models:l.models.filter(e=>"success"===e.status).map(e=>e.model)}))}let c={query:o??`${e.coordinates.latitude},${e.coordinates.longitude}`,resolved:e},f=await (0,d.nQ)(c,t,{forecastDays:g}),h=[];for(let e of f.forecasts)h.push({model:e.model,info:n.a4[e.model],forecast:{validFrom:e.validFrom.toISOString(),validTo:e.validTo.toISOString(),daily:e.daily.map(e=>({date:e.date.toISOString(),temperatureMax:e.temperature.max,temperatureMin:e.temperature.min,precipitationTotal:e.precipitation.total,precipitationProbability:e.precipitation.probability,windMaxSpeed:e.wind.maxSpeed,weatherCode:e.weatherCode})),hourlyCount:e.hourly.length},status:"success"});for(let e of f.failures)h.push({model:e.model,info:n.a4[e.model],forecast:{validFrom:"",validTo:"",daily:[],hourlyCount:0},status:"failed",error:e.error.message});h.sort((e,t)=>e.model.localeCompare(t.model));let R=f.forecasts.length>=3?(0,u.b5)(f.forecasts):[],x={location:e,models:h,outliers:R,summary:{totalModels:h.length,successfulModels:f.forecasts.length,failedModels:f.failures.length}};t||await m.set(a,x,1800);let I=Date.now()-r;return(0,p.o3)((0,p.Xj)(x,{fetchedAt:f.fetchedAt,duration:I,models:f.forecasts.map(e=>e.model),cached:!1}))}catch(e){if((0,c.ei)(e))switch(e.code){case"GEOCODING_NOT_FOUND":return(0,p.o3)(p.R0.notFound(`Location not found: ${o}`));case"GEOCODING_INVALID_INPUT":return(0,p.o3)(p.R0.badRequest(e.userMessage));default:return(0,p.o3)(p.R0.serviceUnavailable("Location service temporarily unavailable"))}if((0,c.k0)(e))switch(e.code){case"API_RATE_LIMIT":return(0,p.o3)(p.R0.rateLimited());case"API_TIMEOUT":case"API_UNAVAILABLE":return(0,p.o3)(p.R0.serviceUnavailable("Weather service temporarily unavailable"));default:return(0,p.o3)(p.R0.internalError(e.userMessage))}return console.error("Compare API error:",e),(0,p.o3)(p.R0.internalError())}}async function h(){return(0,p.No)()}let b=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/compare/route",pathname:"/api/compare",filename:"route",bundlePath:"app/api/compare/route"},resolvedPagePath:"/Users/harrison/Github/weather-oracle/packages/web/src/app/api/compare/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:y}=b,w="/api/compare/route";function R(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[879,299,457,683],()=>r(8577));module.exports=a})();