"use strict";(()=>{var e={};e.id=439,e.ids=[439],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},7561:e=>{e.exports=require("node:fs")},3977:e=>{e.exports=require("node:fs/promises")},612:e=>{e.exports=require("node:os")},9411:e=>{e.exports=require("node:path")},4466:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>b,routeModule:()=>v,serverHooks:()=>R,staticGenerationAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{GET:()=>m,OPTIONS:()=>h});var a=r(1841),n=r(5328),s=r(2153),i=r(7242),d=r(1583),l=r(180),u=r(6347),c=r(6250),p=r(7539);let f=(0,d._j)({enabled:!0});async function m(e){let t=Date.now(),r=e.nextUrl.searchParams,o=r.get("location"),a=r.get("lat"),n=r.get("lon"),s=r.get("days"),d=o&&o.trim().length>0,m=a&&n;if(!d&&!m)return(0,p.o3)(p.R0.badRequest("Must provide either 'location' parameter or both 'lat' and 'lon' parameters"));let h=5;if(s){let e=parseInt(s,10);if(isNaN(e)||e<1||e>7)return(0,p.o3)(p.R0.badRequest("Days must be a number between 1 and 7",{provided:s}));h=e}try{var v,b,g;let e;if(m){let t=parseFloat(a),r=parseFloat(n);if(isNaN(t)||t<-90||t>90)return(0,p.o3)(p.R0.badRequest("Latitude must be a number between -90 and 90",{provided:a}));if(isNaN(r)||r<-180||r>180)return(0,p.o3)(p.R0.badRequest("Longitude must be a number between -180 and 180",{provided:n}));e={name:`${t.toFixed(4)}, ${r.toFixed(4)}`,coordinates:(0,l.DC)(t,r),country:"Unknown",countryCode:"XX",timezone:"UTC"}}else e=await (0,u.lF)(o.trim());let r=(v=e.coordinates.latitude,b=e.coordinates.longitude,g=h,`forecast_${Math.round(100*v)/100}_${Math.round(100*b)/100}_${g}`),s=await f.get(r);if(s){let e=Date.now()-t;return(0,p.o3)((0,p.Xj)(s,{duration:e,cached:!0,models:s.forecast.modelWeights.map(e=>e.model)}))}let d={query:o??`${e.coordinates.latitude},${e.coordinates.longitude}`,resolved:e},c=await (0,u.nQ)(d,void 0,{forecastDays:h});if(0===c.forecasts.length)return(0,p.o3)(p.R0.serviceUnavailable("Unable to fetch forecast data from any weather model"));let R=(0,i.Ao)(c.forecasts),w=(0,i.wL)(R,"overall",0),y=(0,i.Qe)(R,[w]),x={location:e,forecast:{coordinates:R.coordinates,validFrom:R.validFrom.toISOString(),validTo:R.validTo.toISOString(),daily:R.consensus.daily,hourly:R.consensus.hourly,modelWeights:R.modelWeights},confidence:{overall:w,level:w.level,score:w.score},narrative:y};await f.set(r,x,1800);let I=Date.now()-t,A=[...R.models];return(0,p.o3)((0,p.Xj)(x,{fetchedAt:c.fetchedAt,duration:I,models:A,cached:!1}))}catch(e){if((0,c.ei)(e))switch(e.code){case"GEOCODING_NOT_FOUND":return(0,p.o3)(p.R0.notFound(`Location not found: ${o}`));case"GEOCODING_INVALID_INPUT":return(0,p.o3)(p.R0.badRequest(e.userMessage));default:return(0,p.o3)(p.R0.serviceUnavailable("Location service temporarily unavailable"))}if((0,c.k0)(e))switch(e.code){case"API_RATE_LIMIT":return(0,p.o3)(p.R0.rateLimited());case"API_TIMEOUT":case"API_UNAVAILABLE":return(0,p.o3)(p.R0.serviceUnavailable("Weather service temporarily unavailable"));default:return(0,p.o3)(p.R0.internalError(e.userMessage))}return console.error("Forecast API error:",e),(0,p.o3)(p.R0.internalError())}}async function h(){return(0,p.No)()}let v=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/forecast/route",pathname:"/api/forecast",filename:"route",bundlePath:"app/api/forecast/route"},resolvedPagePath:"/Users/harrison/Github/weather-oracle/packages/web/src/app/api/forecast/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:b,staticGenerationAsyncStorage:g,serverHooks:R}=v,w="/api/forecast/route";function y(){return(0,s.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[879,299,457,683],()=>r(4466));module.exports=o})();